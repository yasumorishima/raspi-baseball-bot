# エッジコンピューティングにおける自律型野球情報エージェントの構築
## Raspberry Pi 5、OpenClaw、およびOllamaを用いたNPB/MLB自動配信システムの設計と実装

保存日: 2026-02-18（バグ対応の参考資料）

---

エッジコンピューティングと大規模言語モデル（LLM）の融合は、低遅延、高プライバシー、そして低コストな自律型エージェントの構築を可能にした。特に、Raspberry Pi 5という強力なハードウェアプラットフォームの登場により、従来はクラウド上で行われていた高度な自然言語処理を、電力効率に優れたシングルボードコンピュータ（SBC）上で完結させることが現実的となっている。本レポートでは、Raspberry Pi 5、OpenClaw（旧称：Moltbot/Clawdbot）、およびOllamaを統合し、日本プロ野球（NPB）およびメジャーリーグベースボール（MLB）の情報をリアルタイムで収集・分析し、X（旧Twitter）へ自動投稿するシステムの構築手順を詳述する。また、実装過程で遭遇する可能性のあるハードウェア、ソフトウェア、API、およびセキュリティ上の「罠」についても、技術的深掘りを行いながら解説する。

---

## 第1章 ハードウェアインフラストラクチャの選定と最適化

Raspberry Pi 5は、その設計思想において先代のPi 4から大幅な進化を遂げている。Broadcom BCM2712 クアッドコア Arm Cortex-A76 プロセッサ（2.4GHz）を搭載しており、これはLLMのローカル推論において極めて重要な整数演算および浮動小数点演算能力を提供する。しかし、この高性能化は同時に、電力管理と熱管理という新たな課題をシステム設計者に突きつけている。

### 1.1 メモリ容量の決定要因とボトルネックの分析

ローカルLLMを駆動させる上で、RAM容量はシステムの成否を分ける決定的な要素である。Raspberry Pi 5には4GB、8GB、および16GBのバリエーションが存在するが、野球情報の自動ツイートbotを構築する場合、8GBモデルが事実上の最小要件となる。これは、OSのオーバーヘッド、OpenClawのゲートウェイプロセス、Redisによるステート管理、そしてLLMの重みを格納するためのメモリ空間を同時に確保する必要があるためである。

| コンポーネント | 推奨メモリ割当 | 理由 |
|---|---|---|
| OS & バックグラウンドサービス | 512MB - 1GB | 64-bit Raspberry Pi OSの基本動作 |
| Ollama (LLM 1B-3Bクラス) | 2GB - 4GB | 量子化モデル（Q4_K_M）のロード |
| OpenClaw ゲートウェイ & Redis | 512MB - 1GB | メッセージキューとセッション管理 |
| ブラウザ自動化 (Playwright) | 1GB - 2GB | NPBスクレイピング用Chromiumインスタンス |

一部の報告では、RAM容量を増やすことが必ずしも推論速度の向上に直結しない可能性が指摘されているが、複数のエージェントプロセスを同時に走らせる自律型システムにおいては、スワップの発生を防ぐために余裕を持ったメモリ設計が不可欠である。

### 1.2 ストレージデバイスとI/O性能の「罠」

野球情報のbotは、試合結果のログ、過去の投稿履歴、セッションデータなどを頻繁にディスクに書き込む。標準的なmicroSDカードを使用した場合、書き込み回数の多さによる寿命の短縮や、I/O待機によるシステム全体のハングアップが深刻な「罠」となる。特にOpenClawのようなエージェントフレームワークは、ディスク上のMarkdownファイルを「記憶」として利用するため、高速な読み書き能力が求められる。

この解決策として、NVMe SSDをPCIeインターフェース経由で接続することが推奨される。NVMeを使用することで、LLMモデルのロード時間はmicroSD比較で数分から数秒へと短縮され、エージェントの推論サイクルが大幅に改善される。PCIe 3.0モードを有効化（/boot/firmware/config.txtへの追記）することで、更なるパフォーマンス向上が期待できるが、これは公式にはサポート外の設定となるため、安定性とのトレードオフを考慮する必要がある。

### 1.3 熱設計電力（TDP）とアクティブクーリングの必然性

Raspberry Pi 5は、高負荷時にはSoC温度が急速に上昇する。推論エンジンであるOllamaが動作する際、CPUの全コアが100%に近い稼働率となり、適切な冷却がない場合は数秒で82°Cの閾値に達し、サーマルスロットリングが発生する。スロットリングが発生するとクロック周波数が低下し、LLMの応答時間がOpenClawのデフォルトのタイムアウト（500秒など）を超えてしまい、エージェントが「無回答」となる連鎖的な障害を引き起こす。

したがって、アクティブクーラーやアルゴンNEO 5のようなファン付きケースの導入は、24時間365日の稼働を目指す野球botにおいて、オプションではなく必須の構成要素である。

---

## 第2章 Ollamaを用いたローカルLLM環境の構築と最適化

Ollamaは、ローカル環境でのLLM実行を簡素化する強力なライブラリであり、Raspberry Pi 5上での動作も公式にサポートされている。野球情報の要約というタスクにおいては、文脈の理解度と生成速度のバランスが重要であり、Pi 5の計算リソースに最適化されたモデルの選定が必要となる。

### 2.1 64-bit OSの必然性とモデル量子化の選択

第一の「罠」は、32-bit OSの使用である。Ollamaおよびその背後にあるllama.cppはARM64アーキテクチャに最適化されており、32-bit環境では実行できない、あるいは著しく性能が低下する。インストールには、Raspberry Pi OS Lite (64-bit) または Ubuntu Server 24.04 ARM64 が適している。

モデルの量子化（Quantization）についても理解が必要である。Pi 5では、4-bit量子化モデル（Q4_0 または Q4_K_M）が推奨される。これは、精度の低下を最小限に抑えつつ、メモリ使用量を劇的に削減し、CPUのSIMD命令（NEON）を効率的に利用できるためである。

| モデル | パラメータ数 | 推論速度 (tokens/s) | 特徴 |
|---|---|---|---|
| Llama 3.2 | 1B | 11.22 | 高速、簡潔な要約に適する |
| Qwen 2.5 | 1.5B | 9.97 | 日本語の理解度が高く、NPB情報の処理に有利 |
| Phi-3 Mini | 3.8B | 5.20 | 高い論理性能だが、Pi 5ではやや重い |
| TinyLlama | 1.1B | 15.00+ | 非常に高速だが、複雑な要約で破綻しやすい |

### 2.2 システム設定におけるコンテキスト長の罠

OllamaをOpenClawと組み合わせて使用する際、環境変数 `OLLAMA_CONTEXT_LENGTH` の設定が重要となる。デフォルトでは4096トークンに制限されていることが多いが、野球の試合データ（全イニングのスコア、打撃成績、投手成績のJSONデータなど）は非常に巨大になる場合がある。

コンテキスト長が不足すると、データの前半部分（例えば先発投手の成績）が欠落し、不正確な要約が生成される原因となる。しかし、コンテキスト長を安易に増やす（例：32768トークン）と、KVキャッシュがRAMを圧迫し、推論中にプロセスが強制終了されるリスクが高まる。Pi 5の8GBモデルでは、4096から8192トークン程度が安定稼働の限界値であると判断すべきである。

### 2.3 Ollamaサービス管理とオーバーライド設定

Ollamaをシステムサービスとして安定させるためには、systemdのオーバーライド設定が有効である。特に、Raspberry Piではモデルのロードに時間がかかるため、`OLLAMA_LOAD_TIMEOUT` を延長（例：60分）設定しておかないと、モデルの初回ロード中にサービスがタイムアウトして終了してしまう「罠」がある。

```ini
Environment="OLLAMA_HOST=0.0.0.0:11434"
Environment="OLLAMA_KEEP_ALIVE=-1"
Environment="OLLAMA_MAX_LOADED_MODELS=1"
```

`OLLAMA_KEEP_ALIVE=-1` を設定することで、一度ロードされたモデルをメモリ上に常駐させることができる。これにより、ツイート投稿のたびに発生するモデルの再ロード時間をゼロに短縮できるが、他のメモリ集約型プロセス（スクレイピング用ブラウザなど）との競合には注意が必要である。

---

## 第3章 OpenClawエージェントフレームワークの設計

OpenClawは、単なるチャットUIではなく、OS、ファイルシステム、ブラウザ、そして外部メッセージングアプリを統合する「ゲートウェイ」として機能する自律型エージェントである。野球botにおいて、OpenClawは「いつ情報を取得し、どのように整形し、どのタイミングでツイートするか」という意思決定の脳の役割を果たす。

### 3.1 ゲートウェイ、ノード、インテグレーションの三層構造

OpenClawのアーキテクチャは以下の三層で構成されており、それぞれがRaspberry Pi上で正しく連携する必要がある。

- **ゲートウェイ (Gateway)**: Node.js上で動作し、すべてのメッセージングインターフェース（X, Telegram, Discord）を統合する。Pi 5上では、外部からのリクエストを待ち受けるWebSocketサーバーとして機能する。
- **ノード (Node)**: システムリソースへのアクセスを管理する。ファイル操作やシェルコマンドの実行（exec）を担当し、野球データの取得用スクリプトを呼び出す役割を担う。
- **インテグレーション層 (Skills)**: 特定のプラットフォーム向けの「知識」を提供する。bird（X用スキル）やcron（スケジューリング用スキル）がこれに該当する。

### 3.2 セキュリティ上の罠：悪意あるスキルの混入

OpenClawの最大の利点はコミュニティによって作成された「スキル」による拡張性だが、これは同時に深刻なセキュリティリスクでもある。スキルは実質的にMarkdownファイルやスクリプトの集合体であり、インストール時にOSに対するフルアクセスを要求することが多い。

実際、シスコの調査によれば、コミュニティスキルの約26%に脆弱性が含まれており、中にはmacOSやLinuxのパスワード、APIキー、SSHキーを窃取しようとする悪意あるコードが含まれている事例も報告されている。

野球bot用のスキルをClawHubからインストールする際は、必ずソースコードをレビューし、VirusTotalなどのスキャン結果を確認することが強く推奨される。また、openclaw.jsonの設定で `approvals.exec.enabled` を `true` に設定し、すべてのシェルコマンド実行に手動承認を求める「ガードレール」を設けることも、初期設定における重要なステップである。

### 3.3 OpenClawのインストールとPi 5特有の注意点

インストールは `curl -fsSL https://openclaw.ai/install.sh | bash` コマンドにより自動化されているが、ARMアーキテクチャ上でのビルドには30秒から60秒程度の時間を要する。この間、画面がフリーズしたように見えることがあるが、強制終了させるとパッケージの整合性が壊れるため、忍耐が必要である。

また、ネットワークインターフェースの設定も「罠」になりやすい。デフォルトでは `127.0.0.1` にバインドされるため、外部のブラウザからコントロールUIにアクセスできない場合がある。Pi 5のローカルIP、またはTailscaleなどのVPN IPを指定することで、安全かつ柔軟な管理環境が構築できる。

---

## 第4章 野球データ収集戦略：MLB Stats APIとNPBスクレイピング

自律型botの価値は情報の鮮度と正確性に依存する。MLBとNPBでは、データの取得難易度と手法が大きく異なる。

### 4.1 MLB情報の取得：Stats APIの活用

MLBは世界で最もデータ公開が進んでいるスポーツリーグの一つであり、公式の「MLB Stats API」を通じて詳細なリアルタイム情報を無料で取得できる。

| 手法 | 推奨ライブラリ | 特徴 |
|---|---|---|
| API ラッパー | statsapi (Python) | 簡単にスケジュールやスコアを取得可能 |
| 高度な分析 | pybaseball (Python) | Statcast（打球速度や回転数）の取得に最適 |
| データ検証 | python-mlb-statsapi | Pydanticを用いた堅牢なデータ処理 |

MLB情報をツイートする場合、`statsapi.schedule()` を用いて当日の試合一覧を取得し、各試合の `game_id` を介して `statsapi.boxscore_data()` を呼び出すことで、LLMに渡すためのソースデータを構築できる。

### 4.2 NPB情報の取得：スクレイピングの壁と「罠」

対照的に、NPBにはMLBのような公開APIが存在しない。そのため、多くの開発者は「Yahoo! JAPAN スポーツナビ」などのウェブサイトをスクレイピングする手法を採らざるを得ない。

NPB情報の自動収集における最大の「罠」は、サイト構造の変化とボット検知である。単純な BeautifulSoup によるHTMLパースでは、JavaScriptで動的に生成されるスコアボードを取得できない場合がある。

OpenClawには、ヘッドレスブラウザ（Playwright）を制御する `browser` ツールが組み込まれており、これを利用して「実際にブラウザでページを開き、DOMが描画されるのを待ってから情報を抽出する」という、より人間に近いブラウジング行動を模倣することが推奨される。

npb-scraper のような既存プロジェクトを参考に、Pythonスクリプトを作成し、それをOpenClawの `exec` ツール経由で実行するのが最も現実的な実装である。

### 4.3 データのクレンジングとLLMへのコンテキスト注入

取得した生のJSONやHTMLデータをそのままLLMに投げると、トークン消費が激しくなり、推論時間が大幅に増加する。また、ノイズ（広告テキストやメニュー項目）が混じることで要約精度が低下する。

実装においては、スクレイピング後に必要な項目（得点、安打数、エラー数、注目選手の成績）のみを抽出した「中間Markdown」を生成するレイヤーを挟むことが重要である。

**LLMへのプロンプト例:**

```
以下の野球試合データ（Markdown形式）を読み取り、280文字以内の日本語で、
まるで実況アナウンサーのような熱量のあるツイートを生成してください。
ハッシュタグ #NPB #野球 を含めてください。
```

---

## 第5章 ソーシャルメディア連携とX APIの技術的制約

生成されたテキストをXに投稿する段階で、多くの開発者がAPIのティア構造と認証の複雑さに阻まれる。X API v2の導入以来、開発環境は大きく変貌した。

### 5.1 APIティアの選定と「500件投稿」の罠

現在のX APIには主に「Free」「Basic」「Pro」の3段階が存在する。

| ティア | 月額料金 | 月間投稿上限 | 注意点 |
|---|---|---|---|
| Free | $0 | 500件 | 書き込み専用、検索不可 |
| Basic | $200 | 3,000件 | 中規模bot向け、読み取りも可能 |
| Pro | $5,000 | 100,000件 | 商用大規模プロジェクト向け |

個人で野球botを運用する場合、Freeティアが第一候補となるが、月間500件という制限は「1日あたり約16.6件」の投稿に相当する。NPBとMLBの全試合を速報形式で投稿しようとすると、この制限を数日で使い切ってしまう「罠」がある。したがって、投稿頻度を「試合終了時の要約のみ」に限定するか、あるいは重要なプレイのみに絞り込むアルゴリズムの実装が不可欠である。

### 5.2 OAuth 1.0a vs OAuth 2.0 認証の迷路

X API v2での投稿において、最も一般的な「罠」は認証エラー（401 Unauthorized）である。Freeティアでツイートを投稿するためには、以下の4つのキーを正しく管理し、OAuth 1.0a 署名を生成する必要がある。

1. API Key (Consumer Key)
2. API Secret (Consumer Secret)
3. Access Token
4. Access Token Secret

多くのライブラリ（Pythonのtweepyなど）がこれを簡略化してくれるが、X Developer Portalの設定で「User authentication settings」を有効にし、App permissionsを「Read and Write」に変更した後にアクセスキーを再生成しないと、権限が反映されないという仕様は、初心者が数時間ハマるポイントである。

### 5.3 ブラウザ自動化による投稿（非API手法）の是非

APIのコストや制限を回避するために、OpenClawの `browser` ツール（Playwright）を使用してブラウザ経由でツイートを投稿する手法がある。x-publish スキルなどは、投稿画面を開き、クリップボード経由でテキストを貼り付けて「投稿」ボタンをクリックするプロセスを自動化する。

しかし、これはXの利用規約に抵触する可能性が高く、また「人間ではないブラウジング行動」として検知され、アカウントが即座にBANされるリスクを伴う。特にRaspberry Piのような固定IPからの定期的な自動投稿はフラグが立ちやすいため、長期的な運用を考えるのであれば、Freeティアの公式APIを利用する方が安全である。

---

## 第6章 スケジューリングと自律動作の最適化

botが人間を介さずに動作するためには、適切なスケジューリングと異常検知の仕組みが必要である。OpenClawにおける自動化は、cronツールと「ハートバート（Heartbeat）」の二本柱で構成される。

### 6.1 Cronツールによる定時実行の構成

野球の試合は開催時間が決まっているため、cronツールを用いた定時実行が最も効率的である。OpenClawの `cron` ツールは、指定した時間に「プロンプト」を自分自身に投げかける機能を持つ。

```json
{
  "name": "Evening Recap",
  "at": "22:00",
  "message": "すべての試合結果を取得して要約し、ツイートしてください。"
}
```

この設定の「罠」は、試合時間が延長された場合である。NPBでは引き分け制度があるが、MLBでは決着がつくまで続くため、22:00の時点で試合が終わっていないケースが多々ある。実装においては、スクレイピングスクリプト側で「試合ステータス（進行中・終了・延期）」を判断し、進行中の場合は「まだ試合中である」旨をログに残して終了するか、あるいは15分後に再実行を予約するような条件分岐が必要となる。

### 6.2 ハートバートによる動的モニタリング

より高度な自動化を目指す場合、OpenClawの「ハートバート」機能を利用する。これは数分おきにエージェントが `HEARTBEAT.md` という指示書を読み、状況を判断する仕組みである。

しかし、エッジデバイスにおけるハートバートには「計算コスト」の罠がある。数分おきにLLMを呼び出して「今は何時か？試合は動いているか？」を考えさせると、Pi 5は常に高負荷状態となり、電力消費と熱の問題が深刻化する。

推奨されるアプローチは、「安価な決定論的チェック（Pythonスクリプトによる時刻とAPIステータスの確認）」を先に行い、確信度が低い場合や要約が必要な場合にのみLLMを起動する「レイヤード・ハートバート」戦略である。

### 6.3 プロンプトエンジニアリングによる要約精度の向上

エージェントがデータを解釈する際の「罠」の一つに、ハルシネーション（もっともらしい嘘）がある。特に野球のスコアのような数値データにおいて、打率や防御率をLLMが計算し直すと、しばしば誤った値を生成する。

これを防ぐためのプロンプト技術として、「思考の連鎖（Chain of Thought）」が有効である。

```
1. データのスコア部分を確認し、勝敗を特定してください。
2. 勝利投手を特定してください。
3. 最も活躍した打者（本塁打を打った、または打点が多い選手）を選んでください。
4. これらの要素を組み合わせてツイートを作成してください。
   計算は行わず、記載された数値のみを使用してください。
```

---

## 第7章 運用における技術的な「罠」とトラブルシューティング

システムの構築が完了した後も、エッジデバイス特有の運用上の課題が次々と現れる。これらを予見し、対策を講じることが、安定運用の鍵となる。

### 7.1 メモリリークとプロセスのゾンビ化

Raspberry Pi 5上での長期運用において、Playwright（Chromium）のプロセスが正常に終了せず、メモリを食いつぶし続ける事例が散見される。8GBのメモリは一見十分に見えるが、数日間の連続稼働でメモリが断片化し、最終的にOSのOOM KillerがOllamaやOpenClawを停止させてしまう。

対策として、OpenClawを `systemd` サービスとして管理し、`Restart=always` を設定すると同時に、一日の終わりにシステム全体を `reboot` する、あるいは `cron` で定期的に `npm cache clean` やブラウザプロセスの強制終了を行うメンテナンス・スクリプトを走らせることが推奨される。

### 7.2 タイムアウトと「沈黙のbot」

LLMの推論には時間がかかる。特にPi 5で3Bクラスのモデルを走らせると、要約に30秒から1分を要することがある。OpenClawのゲートウェイや、接続しているメッセージングアプリ（特にTelegramの500秒制限など）のタイムアウト設定が短いと、エージェントが思考を終える前に接続が切断され、投稿が失敗する。

`openclaw.json` の `agents.defaults.timeoutSeconds` を十分に長い値（例：3600）に設定し、またLLMの推論状況を `journalctl -u openclaw -f` でリアルタイム監視できる環境を整えておくことが、原因不明の「沈黙」を解消するために重要である。

### 7.3 ストレージの摩耗とデータの永続性

データベース（SQLiteやRedis）の書き込みが頻繁に行われる自律型botにおいて、microSDカードの寿命は数ヶ月、早ければ数週間で尽きることがある。

| 指標 | microSD | NVMe SSD |
|---|---|---|
| ランダムアクセス速度 | 低い | 非常に高い |
| 耐久性 (TBW) | 非常に低い | 高い |
| 価格 | 安価 | 中程度 |
| 推奨用途 | OSブート（リードオンリー） | ログ、DB、モデル |

botが「昨日までの試合結果を覚えている」という長期記憶を実現するためには、永続化レイヤーをSSD上に配置することが必須である。

### 7.4 ネットワークのIPv6問題

Raspberry PiからX APIやTelegram APIにアクセスする際、IPv6が有効になっている環境では名前解決に失敗し、数分間のハングアップが発生することがある。これは「5〜8分の応答遅延」として現れることが多く、一見するとLLMの推論が遅いように誤認されるが、実際にはネットワークのタイムアウト待ちである。

`/etc/sysctl.conf` でIPv6を無効化するか、あるいはIPv4を優先する設定に変更することで、この不可解な遅延を回避できる。

---

## 第8章 自律型bot構築の最終ステップ：デプロイメント・チェックリスト

### 8.1 初期セットアップ段階

- [ ] OS: Raspberry Pi OS 64-bit (Lite) を NVMe SSD にインストール
- [ ] 冷却: アクティブクーラーの装着と、PWM制御の正常動作確認
- [ ] 依存関係: Node.js (v20+), Python (3.11+), Redis, git のインストール

### 8.2 Ollama の構成

- [ ] モデルのプル: `ollama pull qwen2.5:1.5b`
- [ ] サービスオーバーライド: ロードタイムアウトの延長
- [ ] 推論テスト: `ollama run` で日本語の要約が生成されることを確認

### 8.3 OpenClaw の統合

- [ ] クイックスタートによるインストール
- [ ] ゲートウェイのバインド設定: セキュアな管理アクセスの確保
- [ ] スキルの有効化: cron, exec, bird (X API用) の設定
- [ ] 認証: X Developer Portal での OAuth 1.0a 設定とキーの再生成

### 8.4 野球ロジックの実装

- [ ] MLB/NPB 取得スクリプトの作成
- [ ] プロンプトテンプレートの調整: ハルシネーション対策とキャラ付け
- [ ] スケジュールの登録: 試合終了時間に合わせた cron ジョブの追加

---

## 第9章 結論と今後の展望

Raspberry Pi 5、OpenClaw、およびOllamaを用いた野球自動投稿botの構築は、エッジAIの可能性を最大限に引き出す実戦的なプロジェクトである。本システムは、プライバシーの確保、ランニングコストの最小化、そしてハードウェアの限界に挑む高度な技術的洗練を兼ね備えている。

しかし、その道のりには「熱」「メモリ」「API制限」「セキュリティ」という幾多の罠が潜んでいる。本レポートで詳述した対策、すなわち、NVMe SSDによる高速I/Oの確保、アクティブクーリングによる熱制御、4-bit量子化モデルの選定、そして承認制の実行環境によるセキュリティ強化を施すことで、これらの罠を回避し、安定した自律型エージェントの運用が可能となる。

今後、エッジ向けモデルの軽量化と、OpenClawのようなエージェントフレームワークのさらなる成熟により、野球情報のみならず、個人の生活に密着した多種多様な自律型アシスタントが、私たちの手のひらサイズのコンピュータ上で当たり前に動作する時代が到来するだろう。

このbot構築を通じて得られる、ハードウェアからAI、ネットワークに至るフルスタックの知識は、次世代のAI活用における極めて貴重な資産となる。
